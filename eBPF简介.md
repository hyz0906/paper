## eBPF
#### 1. 定义
BPF是Linux内核⼀种⾰命性的技术，起源于Linux内核，可以在内核中运⾏沙盒程序。该技术可以安全⽽⾼效地拓展内核的能⼒，⽽⽆需修改内核源代码或者装载内核模块
####  2. eBPF与JavaScript
eBPF 与内核的关系有点类似于 JavaScript 与浏览器内核的关系
运行完成，而不会造成系统的崩溃
- JavaScript 可以在⽹⻚中实现复杂功能，即⽹⻚不再是静态内容：内容及时更新、地图交互、绘制图形，影⽚控制……等
事件驱动
安全性：沙盒JavaScript程序
性能： JIT

- eBPF 可以在⽹⻚中实现复杂功能，即⽹⻚不再是静态内容：内容及时更新、地图交互、绘制图形，影⽚控制……等
事件驱动
安全性：沙盒JavaScript程序
性能： JIT
#### 3. eBPF与内核模块
eBPF 相比于直接修改内核和编写内核模块提供了一种新的内核可编程的选项。eBPF 程序架构强调安全性和稳定性，看上去更像内核模块，但与内核模块不同，eBPF 程序不需要重新编译内核，并且可以确保 eBPF 程序。
#### 4. eBPF架构
eBPF 分为用户空间程序和内核程序两部分：
- 用户空间程序负责加载 BPF 字节码至内核，如需要也会负责读取内核回传的统计信息或者事件详情
- 内核中的 BPF 字节码负责在内核中执行特定事件，如需要也会将执行的结果通过 maps 或者peÅ-event 事件发送至用户空间
- 其中用户空间程序与内核 BPF 字节码程序可以使用 map 结构实现双向通信，这为内核中运行的 BPF 字节码程序提供了更加灵活的控制

用户空间程序与内核中的 BPF 字节码交互的流程主要如下：
1. 使用 LLVM 或者 GCC 工具将编写的 BPF 代码程序编译成 BPF 字节码
2. 使用加载程序 Loader 将字节码加载至内核
3. 内核使用验证器（VeÅier） 组件保证执行字节码的安全性，以避免对内核造成灾难，在确认字
节码安全后将其加载对应的内核模块执行
4. 内核中运行的 BPF 字节码程序可以使用两种方式将数据回传至用户空间
- maps 方式可用于将内核中实现的统计摘要信息（比如测量延迟、堆栈信息）等回传至用
户空间；
- perf-event 用于将内核采集的事件实时发送至用户空间，用户空间程序实时读取分析；
#### 5. eBPF的应用
- 可观测性
- 安全 网络数据包过滤 流量控制 网络策略
- 连接时负载均衡 提升性能
- 服务网格 cilium